<!DOCTYPE html>
<html>
  <head>
    <title></title>
  </head>
  <body>
    <div>
      <small>Get Fetch JSON</small>
      <h1><!-- Name --></h1>
      <h2><!-- Rank --></h2>
    </div>

    <div>
      <small>Send form data</small>
      <form id="send-form">
        <input id="send-input" type="text" placeholder="type anything">
        <button>Submit</button>
      </form>
      <p id="send-form-results"> - </p>
    </div>

    <button id="random-color">Random Color</button>
    <small id="show-color"></small>

    <script>
      // ----------------------------------------------
      // Loads data from the route /data (see app.py)

      // This example requests JSON from the route /data

      fetch('/data').then(function(res) {
        return res.json()
      }).then(function(json) {
        const h1 = document.querySelector('h1')
        const h2 = document.querySelector('h2')
        // Use the JSON data to populate these elements
        h1.innerHTML = json.name 
        h2.innerHTML = json.rank
      }).catch(function(err) {
        console.log(err.message)
      })


      // ----------------------------------------------
      // Send data from a form to the route /send-data (see app.py)

      // This example takes the input in the form and sends this to 
      // the server (app.py) /send-data. This route receives the 
      // data and sends it back. 

      // Reference some DOM elements to get form input and display the result
      const sendForm = document.getElementById('send-form')
      const sendInput = document.getElementById('send-input')
      const sendResults = document.getElementById('send-form-results')
      const randomColor = document.getElementById('random-color')
      const showColor = document.getElementById('show-color')

      // Handle form submit
      sendForm.addEventListener('submit', function(e) {
        e.preventDefault() // Prevent the default behavior
        const str = sendInput.value // get the input string

        // Set up some options for fetch
        // Method is POST
        // Headers to JSON
        // Attach convert our JS Object to JSON and add it to the body of the message
        const options = {
          method: 'post',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ data: str })
        }

        // Query the /send-data route with fetch
        fetch('/send-data', options)
          .then(function(res){
            return res.json()
          }).then(function(json){
            // Handle the response and display the data received
            sendResults.innerHTML = json.data
          }).catch(function(err) {
            console.log(err.message)
          })
      })

      // Get a random color
      randomColor.addEventListener('click', function(e) {
        const n = Math.floor(Math.random() * 3)
        const url = `/send-query?index=${n}`
        fetch(url).then(function(res) {
          return res.json()
        }).then(function(json) {
          console.log(json)
          showColor.innerHTML = json.color
        }).catch(function(err) {
          console.log(err.message)
        })
      })
    </script>
  </body>
</html>